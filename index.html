<html>
<head>
	<script>
		var ready = false;
		var canvas = null;
		var ctx = null;
		var sprites = [];
		var gravityInPixelsPerSecond = 100;
		var worldWidth = 400;
		var worldHeight = 200;

		window.requestAnimFrame = (function(){
		  return  window.requestAnimationFrame       ||
		          window.webkitRequestAnimationFrame ||
		          window.mozRequestAnimationFrame    ||
		          function( callback ){
		            window.setTimeout(callback, 1000 / 60);
		          };
		})();

		function initialize() {
			canvas = document.getElementById('tutorial');
			ctx = canvas.getContext('2d');
			ready = true;

			sprites.push({
				type: 'rectangle',
				x: 0,
				y: 0,
				width: 20,
				height: 20,
				color: '#FF0000',
				gravity: true,
				xMovement: 0,
				yMovement: 0
			});
			sprites.push({
				type: 'circle',
				x: 100,
				y: 100,
				radius: 20,
				color: '#00FF00',
				gravity: true,
				xMovement: 0,
				yMovement: 0
			});
			sprites.push({
				type: 'circle',
				x: 100,
				y: 0,
				radius: 5,
				color: 'yellow',
				gravity: true,
				xMovement: 0,
				yMovement: 0
			});
			animateWorld();
		}

		function onAnimationFrame() {
			if (!ready) {
				return;
			}

			ctx.fillStyle = "#DDDDDD";
			ctx.fillRect(0, 0, worldWidth, worldHeight);

			for (var i = 0; i < sprites.length; i++) {
				var sprite = sprites[i];
				if (sprite.type === 'rectangle') {
					ctx.fillStyle = sprite.color;
					ctx.fillRect(sprite.x, 
						sprite.y,
						sprite.width,
						sprite.height);
				}
				else if (sprite.type === 'circle') {
					ctx.beginPath();
				    ctx.arc(sprite.x, sprite.y, sprite.radius, 0, 2 * Math.PI, false);
				    ctx.fillStyle = sprite.color;
				    ctx.fill();
				    ctx.lineWidth = 5;
				    ctx.strokeStyle = sprite.color;
				    ctx.stroke();
				}
			}
			
		}

		function collisionCircles(circleA, circleB) {
			var distanceX = circleA.x - circleB.x;
			var distanceY = circleA.y - circleB.y;
			var radiusSum = circleA.radius + circleB.radius;

			distanceX = distanceX * distanceX;
			distanceY = distanceY * distanceY;
			radiusSum = radiusSum * radiusSum;

			return distanceX + distanceY < radiusSum;
		}

		function collisionCircleToRectangle(circle, rectangle) {
		}

		function animateWorld() {
			var interval = 10;
			window.setInterval(function () {
				for (var i = 0; i < sprites.length; i++) {
					var sprite = sprites[i];
					var pixelsToMoveY = sprite.xMovement;
					var pixelsToMoveX = sprite.yMovement;
					var initialX = sprite.x;
					var initialY = sprite.y;

					//should decrease exponentially and depending
					//on collision..
					sprite.xMovement = 0;
					sprite.yMovement = 0;

					if (sprite.gravity) {
						pixelsToMoveY = pixelsToMoveY + gravityInPixelsPerSecond * interval / 1000;
					}
					if (pixelsToMoveY === 0 && pixelsToMoveX === 0)
					{
						continue;
					}

					sprite.y = sprite.y + pixelsToMoveY;
					sprite.x = sprite.x + pixelsToMoveX;

					if (sprite.type === 'rectangle') {
						if (sprite.y + sprite.height > worldHeight)
						{
							sprite.y = worldHeight - sprite.height;
						}
						
						if (sprite.x + sprite.width > worldWidth)
						{
							sprite.x = worldWidth - sprite.width;
						}
					}
					else if (sprite.type === 'circle') {
						if (sprite.y + sprite.radius > worldHeight)
						{
							sprite.y = worldHeight - sprite.radius;
						}
						
						if (sprite.x + sprite.radius > worldWidth)
						{
							sprite.x = worldWidth - sprite.radius;
						}
					}

					var collision = false;
					for (var j = 0; j < sprites.length; j++) {
						if (i === j) {
							continue;
						}
						var spriteToCheck = sprites[j];
						if (sprite.type === 'circle' && 
							spriteToCheck.type === 'circle') {
							if (collisionCircles(sprite, spriteToCheck)) {
								collision = true;
								break;
							}
						}
						else if (sprite.type === 'circle' && 
							spriteToCheck.type === 'rectangle') {
							if (collisionCircleToRectangle(sprite, spriteToCheck)) {
								collision = true;
								break;
							}
						}
					}

					if (collision) {
						sprite.x = initialX;
						sprite.y = initialY;
					}
				}
			}, interval);
		}

		window.onload = initialize;
		window.setInterval(onAnimationFrame, 10);
	</script>
</head>
<body>
	<canvas id="tutorial" width="400" height="200"></canvas>
</body>
</html>
